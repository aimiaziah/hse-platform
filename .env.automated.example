# ============================================
# MICROSOFT AUTHENTICATION - FULLY AUTOMATED
# ============================================
# This configuration automatically assigns roles based on email
# No admin UI interaction needed - users get correct role on login
#
# Perfect for:
# - Fixed team structure (1 admin, 1 supervisor, 1 inspector)
# - When roles rarely change
# - Fully automated onboarding
#
# Copy this file to .env and update with your values
# ============================================

# ============================================
# CORE CONFIGURATION
# ============================================

# Supabase (Required)
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# JWT (Required)
# Generate with: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
JWT_SECRET=your-64-character-random-string

# ============================================
# MICROSOFT AUTHENTICATION (Required)
# ============================================

# Enable Microsoft OAuth
ENABLE_MICROSOFT_AUTH=true
PREFER_MICROSOFT_AUTH=true

# Azure AD Application Credentials
NEXT_PUBLIC_SHAREPOINT_OAUTH_CLIENT_ID=abc123-def456-ghi789
NEXT_PUBLIC_SHAREPOINT_TENANT_ID=xyz987-uvw654-rst321

# ============================================
# SECURITY (Required)
# ============================================

# Restrict logins to your company domain
ALLOWED_EMAIL_DOMAINS=theta-edge.com

# ============================================
# AUTOMATIC ROLE ASSIGNMENT (Email Whitelists)
# ============================================

# Admin - Gets full system access
ADMIN_EMAIL_WHITELIST=hse-platform@theta-edge.com

# Supervisor - Gets review and approval permissions
SUPERVISOR_EMAIL_WHITELIST=jane.supervisor@yourcompany.com

# Inspector - Gets inspection creation permissions
INSPECTOR_EMAIL_WHITELIST=aimi.azizul@theta-edge.com

# Everyone else automatically gets "employee" role
# No need to list all 100 employee emails!

# ============================================
# HOW IT WORKS (FULLY AUTOMATED)
# ============================================
#
# 1. john.admin@yourcompany.com logs in
#    → Auto-assigned "admin" role
#    → Can manage users, forms, view analytics
#
# 2. jane.supervisor@yourcompany.com logs in
#    → Auto-assigned "supervisor" role
#    → Can review and approve inspections
#
# 3. bob.inspector@yourcompany.com logs in
#    → Auto-assigned "inspector" role
#    → Can create inspections
#
# 4. Any other employee (employee1@, employee2@, ...) logs in
#    → Auto-assigned "employee" role
#    → Can view assigned inspections
#
# NO ADMIN INTERACTION NEEDED!
#
# ============================================

# ============================================
# ADDING MORE USERS TO ROLES
# ============================================

# To add multiple admins:
# ADMIN_EMAIL_WHITELIST=admin1@company.com,admin2@company.com

# To add multiple supervisors:
# SUPERVISOR_EMAIL_WHITELIST=supervisor1@company.com,supervisor2@company.com

# To add multiple inspectors:
# INSPECTOR_EMAIL_WHITELIST=inspector1@company.com,inspector2@company.com,inspector3@company.com

# ============================================

# ============================================
# CHANGING ROLES LATER
# ============================================
#
# Option 1: Update environment variables (requires restart)
# - Update the email whitelist above
# - Restart the app
# - User will get new role on next login
#
# Option 2: Use Admin UI (no restart needed)
# - Admin logs in
# - Goes to /admin/users
# - Edits user and changes role
# - Changes take effect immediately
#
# Database role ALWAYS overrides whitelist!
#
# ============================================

# ============================================
# OPTIONAL CONFIGURATIONS
# ============================================

# Enable PIN authentication alongside Microsoft (optional)
ENABLE_PIN_AUTH=true

# Rate limiting for authentication
AUTH_RATE_LIMIT_MAX_REQUESTS=5
AUTH_RATE_LIMIT_WINDOW_MS=900000

# SharePoint Integration with OAuth (optional, but FREE!)
# For automatic export of inspection forms to SharePoint
NEXT_PUBLIC_SHAREPOINT_SITE_URL=https://thetaedgebhd.sharepoint.com/sites/ThetaEdge
NEXT_PUBLIC_SHAREPOINT_TENANT_ID=xyz987-uvw654-rst321
NEXT_PUBLIC_SHAREPOINT_OAUTH_CLIENT_ID=abc123-def456-ghi789
SHAREPOINT_CLIENT_SECRET=your-client-secret-here
SHAREPOINT_LIBRARY_NAME=Shared Documents
SHAREPOINT_BASE_FOLDER=HSE/New Document

# Note: SHAREPOINT_CLIENT_SECRET is server-side only (never exposed to client)
# This enables automatic background uploads without user interaction
# Uses app-only permissions (Sites.ReadWrite.All)

# DigitalOcean Spaces for image storage (optional)
DO_SPACES_NAME=your-space-name
DO_SPACES_REGION=sgp1
DO_SPACES_KEY=your-access-key
DO_SPACES_SECRET=your-secret-key

# ============================================
# QUICK START CHECKLIST
# ============================================
#
# [ ] 1. Create Azure AD app registration
# [ ] 2. Copy this file to .env
# [ ] 3. Update NEXT_PUBLIC_SHAREPOINT_OAUTH_CLIENT_ID
# [ ] 4. Update NEXT_PUBLIC_SHAREPOINT_TENANT_ID
# [ ] 5. Update ADMIN_EMAIL_WHITELIST with admin's email
# [ ] 6. Update SUPERVISOR_EMAIL_WHITELIST with supervisor's email
# [ ] 7. Update INSPECTOR_EMAIL_WHITELIST with inspector's email
# [ ] 8. Update ALLOWED_EMAIL_DOMAINS with your company domain
# [ ] 9. Generate JWT_SECRET
# [ ] 10. Update Supabase credentials
# [ ] 11. Run migration: supabase/migrations/add_microsoft_auth.sql
# [ ] 12. Test login with each role
#
# ============================================

# ============================================
# EXAMPLE FOR YOUR USE CASE
# ============================================
#
# Company: Theta Edge (theta-edge.com)
# Team: 1 admin, 1 supervisor, 1 inspector, 100 employees
#
# Configuration:
# ALLOWED_EMAIL_DOMAINS=theta-edge.com
# ADMIN_EMAIL_WHITELIST=admin@theta-edge.com
# SUPERVISOR_EMAIL_WHITELIST=supervisor@theta-edge.com
# INSPECTOR_EMAIL_WHITELIST=inspector@theta-edge.com
#
# Result:
# - admin@theta-edge.com → admin role (automatically)
# - supervisor@theta-edge.com → supervisor role (automatically)
# - inspector@theta-edge.com → inspector role (automatically)
# - employee1@theta-edge.com → employee role (automatically)
# - employee2@theta-edge.com → employee role (automatically)
# - ... all 100 employees → employee role (automatically)
#
# ============================================

# ============================================
# SUPPORT & DOCUMENTATION
# ============================================
#
# Full Setup Guide: MICROSOFT_AUTH_SETUP.md
# Role Mapping Logic: src/utils/microsoft-auth.ts:135
# Environment Config: src/lib/env.ts:51-54
#
# ============================================
